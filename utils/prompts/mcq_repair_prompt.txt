Role: AP {{ course_name }} item writer.

REPAIR TASK
The previous generation produced validation errors. Generate exactly {{ num_questions }} REPLACEMENT questions.

COMMON VALIDATION ERRORS TO AVOID:
{{ error_summary }}

CRITICAL REMINDERS:
- Generate COMPLETE questions (not partial fixes)
- Use ONLY these allowed skills: {{ allowed_skills_preview }}
- Use ONLY these allowed LOs: {{ allowed_los_preview }}
- Follow TSV format EXACTLY (no deviations)

VALID TSV EXAMPLE (for reference):
easy	1.A,2.B	VAR-1.A,VAR-1.B	0	A researcher recorded heights (in cm) of 50 students. Which measure best describes the center?	Sample mean	Sample median	Range	Standard deviation	none	

Note: Above has 11 columns separated by TABS (not spaces). Column order: diff, skill_codes, lo_ids, correct_idx, stem, A, B, C, D, stim_type, stim_payload

OUTPUT (STRICT TSV)
- EXACTLY {{ num_questions }} lines
- NO header, NO blank lines, NO extra text
- Each line MUST have 11 TAB-separated columns in THIS EXACT ORDER:

diff	skill_codes	lo_ids	correct_idx	stem	A	B	C	D	stim_type	stim_payload

COLUMN RULES

diff:
- easy | medium | hard

skill_codes:
- Comma-separated
- ALL codes MUST be from ALLOWED_SKILLS in unit context
- At least one required

lo_ids:
- Comma-separated
- ALL IDs MUST be from ALLOWED_LOS in unit context
- At least one required

correct_idx:
- 0 | 1 | 2 | 3  (A=0, B=1, C=2, D=3)

stem:
- Clear AP-style question stem
- No explanations
- Avoid explicit references to answer choices unless standard AP style requires it

A, B, C, D:
- Plain text only
- NO labels
- EXACTLY ONE correct
- Never put tables or SVGs inside A/B/C/D. If a table is needed, set stim_type=table and put the entire table in stim_payload.

stim_type:
- none | table | svg

====================
TABLE FORMAT (STRICT)
====================

| Col1 | Col2 | Col3 |
| --- | --- | --- |
| A | 1 | 0.25 |
| B | 2 | 0.50 |

RULES:
- Every row MUST start with "|" and end with "|"
- Header row REQUIRED
- Separator row REQUIRED using "---"
- ALL rows must have the SAME number of columns
- Use literal "\n" between rows
- ONE LINE ONLY in TSV
- NO captions, NO notes, NO extra text

====================
SVG FORMAT (STRICT)
====================

RULES:
- width ≤ 300, height ≤ 200
- White background
- Font size ≥ 12
- Use ONLY: <svg>, <rect>, <line>, <circle>, <text>
- Maximum 8 <text> elements
- No overlapping labels
- Black or dark gray strokes only
- No gradients, no transforms, no stylesheets

====================
stim_payload rules
====================

- If stim_type = none → MUST be empty
- If stim_type = table → pipe table ONLY
- If stim_type = svg → inline <svg>...</svg>
- ONE LINE ONLY
- No scripts or external references

STIMULUS REQUIREMENT
- If stim_type ≠ none, the stimulus MUST be required to answer the question

FINAL VALIDATION
- Exactly {{ num_questions }} lines
- Exactly 11 columns per line
- Any violation invalidates the entire output

UNIT CONTEXT
{{ unit_context }}
